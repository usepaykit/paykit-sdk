---
title: 'Polar'
description: 'Integrate Polar payments with PayKit.'
date: '2025-10-30'
published: true
toc: true
---

PayKit provides seamless Polar integration with a unified API that works across all payment providers.

## Quick Start

Install the Polar provider:

<br />

```bash
# terminal
npm install @paykit-sdk/polar
```

## Setup

### Method 1: Environment Variables

<br />

```typescript
// lib/paykit.ts
import { PayKit } from '@paykit-sdk/core';
import { polar } from '@paykit-sdk/polar';

const provider = polar(); // Ensure POLAR_ACCESS_TOKEN environment variable is set
const paykit = new PayKit(provider);

export { paykit };
```

### Method 2: Direct Configuration

<br />

```typescript
// lib/paykit.ts
import { PayKit } from '@paykit-sdk/core';
import { createPolar } from '@paykit-sdk/polar';

const provider = createPolar({
  accessToken: 'oat..',
  isSandbox: true,
  debug: true,
});

const paykit = new PayKit(provider);

export { paykit };
```

## Basic Usage

<br />

Next.js catchâ€‘all route. This forwards calls to the generated handlers.

<br />

```typescript
// app/api/paykit/[...endpoint]/route.ts
import { endpoints } from '@/lib/paykit';
import type { EndpointArgs, EndpointHandler, EndpointPath } from '@paykit-sdk/core';
import { NextResponse, NextRequest } from 'next/server';

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ endpoint: string[] }> },
) {
  const { endpoint: endpointArray } = await params;
  const endpoint = ('/' + endpointArray.join('/')) as EndpointPath;
  const handler = endpoints[endpoint] as EndpointHandler<typeof endpoint>;

  if (!handler) {
    return NextResponse.json({ message: 'Endpoint not found' }, { status: 404 });
  }

  const body = await request.json();
  const { args } = body as { args: EndpointArgs<typeof endpoint> };
  try {
    const result = await handler(...args);
    return NextResponse.json({ result });
  } catch (error) {
    return NextResponse.json(
      { message: error instanceof Error ? error.message : 'Internal server error' },
      { status: 500 },
    );
  }
}
```

## Webhook Setup

### Enable Events

In your Polar dashboard, enable the following webhook events:

- `order.paid`
- `order.created`
- `customer.created`
- `customer.updated`
- `customer.deleted`
- `subscription.updated`
- `subscription.created`
- `subscription.revoked`
- `refund.created`

### Next.js API Route

<br />

Webhook route. This validates and dispatches events.

<br />

```typescript
// app/api/paykit/webhook/route.ts
import { paykit } from '@/lib/paykit';
import type { NextRequest } from 'next/server';
import { NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;
  if (!webhookSecret) {
    return NextResponse.json({ error: 'Webhook secret not configured' }, { status: 500 });
  }

  const webhook = paykit.webhooks
    .setup({ webhookSecret })
    .on('customer.created', async event => {})
    .on('subscription.created', async event => {})
    .on('payment.created', async event => {})
    .on('refund.created', async event => {})
    .on('invoice.generated', async event => {});

  const body = await request.text();
  const headers = request.headers;
  const url = request.url;

  await webhook.handle({ body, headers, fullUrl: url });

  return NextResponse.json({ success: true });
}
```

### Vite.js

<br />

```typescript
// server/api/webhook/stripe.ts
import { paykit } from '@/lib/paykit';

export default defineEventHandler(async event => {
  const webhook = paykit.webhooks
    .setup({ webhookSecret: process.env.STRIPE_WEBHOOK_SECRET! })
    .on('customer.created', async event => {
      console.log('customer created:', event.data);
    })
    .on('subscription.created', async event => {
      console.log('subscription created:', event.data);
    })
    .on('invoice.generated', async event => {
      console.log('invoice generated:', event.data);
    });

  const headers = getHeaders(event);
  const body = await readBody(event);
  const url = event.url;

  await webhook.handle({ body, headers, fullUrl: url });

  return { success: true };
});
```

## Environment Variables

<br />

```bash
# .env
POLAR_ACCESS_TOKEN=polar_oat_...
POLAR_WEBHOOK_SECRET=your-webhook-secret
```

## Support

- [Polar Documentation](https://docs.polar.sh/)
- [PayKit Issues](https://github.com/usepaykit/paykit-sdk/issues)
