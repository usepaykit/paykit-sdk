---
title: 'Next.js'
description: 'Install and configure PayKit for Next.js.'
date: '2025-10-30'
published: true
toc: true
---

## Install with shadcn

Add a PayKit block for Next.js:

<br />

```bash
npx shadcn@latest add https://usepaykit.dev/r/stripe-nextjs-hooks
```

## Manual Setup

Create a provider entry that exports a PayKit instance and generated endpoints

<br />

```typescript
// lib/paykit.ts
import { PayKit } from '@paykit-sdk/core';
import { stripe } from '@paykit-sdk/stripe';

export const paykit = new PayKit(stripe());
export const endpoints = createEndpointHandlers(paykit);
```

<br />

Next.js catch-all route. This forwards calls to the generated handlers.

<br />

```typescript
// app/api/paykit/[...endpoint]/route.ts
import { endpoints } from '@/lib/paykit';
import type { EndpointArgs, EndpointHandler, EndpointPath } from '@paykit-sdk/core';
import { NextResponse, NextRequest } from 'next/server';

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ endpoint: string[] }> },
) {
  const { endpoint: endpointArray } = await params;
  const endpoint = ('/' + endpointArray.join('/')) as EndpointPath;
  const handler = endpoints[endpoint] as EndpointHandler<typeof endpoint>;

  if (!handler) {
    return NextResponse.json({ message: 'Endpoint not found' }, { status: 404 });
  }

  const body = await request.json();
  const { args } = body as { args: EndpointArgs<typeof endpoint> };

  try {
    const result = await handler(...args);
    return NextResponse.json({ result });
  } catch (error) {
    return NextResponse.json(
      { message: error instanceof Error ? error.message : 'Internal server error' },
      { status: 500 },
    );
  }
}
```

Webhook route. This validates and dispatches events.

<br />

```typescript
// app/api/paykit/webhook/route.ts
import { paykit } from '@/lib/paykit';
import type { NextRequest } from 'next/server';
import { NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;

  if (!webhookSecret) {
    return NextResponse.json({ error: 'Webhook secret not configured' }, { status: 500 });
  }

  const webhook = paykit.webhooks
    .setup({ webhookSecret })
    .on('customer.created', async event => {})
    .on('subscription.created', async event => {})
    .on('payment.created', async event => {})
    .on('refund.created', async event => {})
    .on('invoice.generated', async event => {});

  const body = await request.text();
  const headers = request.headers;
  const url = request.url;

  try {
    console.log('Webhook handled');
    await webhook.handle({ body, headers, fullUrl: url });
    return NextResponse.json({ success: true });
  } catch {
    console.error('Webhook error:', error);
    return NextResponse.json({ success: false });
  }
}
```

## Client configuration

Provide baseUrl and headers to the provider entry:

<br />

```tsx
// app/providers.tsx
import * as React from 'react';
import { PaykitProvider } from '@paykit-sdk/react';

export default function Layout({ children }: React.PropsWithChildren) {
  return (
    <PaykitProvider apiUrl="/api/paykit" headers={{ xApiKey: '123456' }}>
      {children}
    </PaykitProvider>
  );
}
```
