---
title: 'Express'
description: 'Install and configure PayKit for Express backends.'
date: '2025-10-30'
published: true
toc: true
---

## Install with shadcn

Add the Express block:

<br />

```bash
npx shadcn@latest add https://usepaykit.dev/r/stripe-express
```

## Manual setup

Create a provider entry and export PayKit and endpoints:

<br />

```ts
// src/lib/paykit.ts
import { PayKit, createEndpointHandlers } from '@paykit-sdk/core';
import { stripe } from '@paykit-sdk/stripe';

export const paykit = new PayKit(stripe());
export const endpoints = createEndpointHandlers(paykit);
```

Create an Express router and mount handlers under /paykit:

<br />

```ts
// src/routes/paykit.ts
import { endpoints } from '@/lib/paykit';
import { EndpointHandler } from '@paykit-sdk/core';
import express from 'express';

const paykitRouter = express.Router();

paykitRouter.post('/*', async (req, res) => {
  const path = req.path as EndpointPath;
  const handler = endpoints[path] as EndpointHandler<typeof path>;

  if (!handler) {
    return res.status(404).json({ message: 'Endpoint not found' });
  }

  const { args } = req.body as { args: EndpointArgs<typeof path> };

  try {
    const result = await handler(...args);
    return res.json({ result });
  } catch (error) {
    console.error('PayKit API Error:', error);
    return res.status(500).json({ message: 'Internal server error' });
  }
});

export default router;
```

## Webhook

<br />

```ts
// src/routes/webhook.ts
import express from 'express';
import { paykit } from '../lib/paykit';

const router = express.Router();

router.post('/webhook', express.text({ type: '*/*' }), async (req, res) => {
  const secret = process.env.STRIPE_WEBHOOK_SECRET;

  if (!secret) {
    return res.status(500).json({ error: 'Webhook secret not configured' });
  }

  const w = paykit.webhooks
    .setup({ webhookSecret: secret })
    .on('customer.created', async event => {
      console.log('Customer created:', event.data);
    })
    .on('subscription.created', async event => {
      console.log('Subscription created:', event.data);
    })
    .on('payment.created', async event => {
      console.log('Payment created:', event.data);
    })
    .on('refund.created', async event => {
      console.log('Refund created:', event.data);
    })
    .on('invoice.generated', async event => {
      console.log('Invoice generated:', event.data);
    });

  // Express stores raw body in req.body when using express.raw()
  const body = typeof req.body === 'string' ? req.body : JSON.stringify(req.body);
  const headers = new Headers(Object.entries(req.headers) as [string, string][]);
  const fullUrl = `${req.protocol}://${req.get('host')}${req.originalUrl}`;

  try {
    console.log('Webhook handled');
    await webhook.handle({ body, headers, fullUrl });
    return res.json({ success: true });
  } catch {
    console.error('Webhook error:', error);
    return res.json({ success: false });
  }
});

export default router;
```

## Environment variables

<br />

```bash
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
```
